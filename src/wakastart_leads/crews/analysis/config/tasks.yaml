---
extraction_and_macro_filtering:
  description: |-
    Traiter l'URL fournie : {url}

    ACT 0 - Extraction & Ingestion :
    1. Vérifier que l'URL est valide et accessible
    2. Formater et normaliser l'URL

    ACT 1 - Extraction & Filtrage Macro :
    1. Vérifier que l'URL est accessible et valide
    2. Scraper le contenu du site pour extraire le nom de l'entreprise
    3. Confirmer le secteur d'activité (Édition logiciels, Conseil informatique, mais rester ouvert aux pivotages)
    4. Critère "SaaS Caché" : Ne pas s'arrêter à la vitrine. Chercher des indices de développement interne :
       - Offres d'emploi "Dev Fullstack" ou similaires
       - Mention de "Plateforme client", "Portail adhérent", "Espace membre"
       - Levées de fonds mentionnant "R&D", "tech", "plateforme"
       - Page "Produit", "Solution", "Tarifs" suggérant un modèle SaaS
    5. Noter si l'URL n'est pas accessible

    ACT 1-BIS - EXTRACTION SIREN (OBLIGATOIRE) :
    Pour l'entreprise identifiée, récupérer le numéro SIREN depuis les mentions légales :
    1. Scraper la page "Mentions légales" du site. Chemins à tester dans l'ordre :
       - /mentions-legales
       - /mentions-legales/
       - /legal
       - /cgv
       - /cgu
       - Chercher un lien "Mentions légales" dans le footer de la page d'accueil
    2. Chercher le numéro SIREN dans le contenu (9 chiffres consécutifs ou espacés)
       Patterns à détecter : "SIREN : XXX XXX XXX", "SIREN: XXXXXXXXX", "RCS [Ville] XXX XXX XXX",
       "N° SIREN", "Immatriculation", "Numéro d'identification"
    3. Si le SIREN n'est pas trouvé dans les mentions légales, chercher dans :
       - Page "À propos" / "Qui sommes-nous"
       - Page "Contact"
       - Conditions générales (CGV/CGU)
    4. IMPORTANT : Le SIREN est CRITIQUE pour identifier correctement l'entreprise.
       Il permet d'éviter les confusions avec des homonymes lors de la recherche Pappers.

    Exemple de référence : France-Care.fr (Service de conciergerie -> Développement d'un CRM métier après levée de fonds)
  expected_output: >
    Une structure pour l'URL contenant :
    - URL originale
    - Statut de validation (valid/invalid)
    - Nom de l'entreprise extrait
    - SIREN extrait (9 chiffres, format XXX XXX XXX) ou "Non trouvé" si introuvable
    - Indices SaaS détectés (liste des signaux trouvés ou "Aucun indice SaaS" si rien détecté)
    - Secteur d'activité apparent

    Format clair indiquant si l'URL a été traitée avec succès ou avec problèmes.
    Le SIREN est OBLIGATOIRE pour les agents suivants - ne jamais l'omettre.
  agent: economic_intelligence_analyst
origin_identification_and_saas_qualification:
  description: |-
    Pour chaque entreprise valide identifiée à l'étape précédente :

    ACT 2 - Identification Origine & Ancrage :
    1. Année de création :
       - UTILISER LE SIREN fourni par la tâche précédente pour rechercher via Pappers
       - Si un SIREN a été extrait (9 chiffres), appeler pappers_search avec ce SIREN directement
       - IMPORTANT : NE PAS rechercher par nom d'entreprise pour éviter les confusions avec les homonymes
       - Si aucun SIREN n'a été trouvé, utiliser le nom en dernier recours
       - Identifier la date d'immatriculation principale. Si pivot majeur
         (ex: agence devenue éditeur), noter l'année du pivot.
    2. Nationalité :
       - Si Siège social = France → FR
       - Si Siège étranger mais présence tech/commerciale forte en France → INT (Lien FR)
       - Sinon → Code pays (US, UK, DE, etc.)
    3. Ne pas supprimer les entreprises sans ancrage français, mais les identifier clairement.

    ACT 3 - Qualification de la Solution SaaS :
    1. Scanner les sources : Site web (rubriques "Produit", "Solution", "Tarifs"),
       documentation technique publique, Github/Gitlab (si public).
    2. Déterminer la typologie :
       - Pur SaaS (modèle abonnement cloud)
       - Marketplace
       - Legacy transformé (outil interne devenu produit)
       - Hybrid (on-premise + cloud)
    3. Identifier la stack technique si visible (PHP, Python, Node, Java, etc.)
    4. Rédiger un résumé concis de la solution (MAXIMUM 20 mots)
       Exemples : "CRM spécialisé santé", "ERP pour PME industrielles", "Plateforme de gestion RH"

    IMPORTANT : Toujours utiliser le SIREN fourni par ACT 1-BIS pour la recherche Pappers.
    Utiliser des sources fiables et croiser les informations pour assurer la précision.
  expected_output: >
    Pour chaque entreprise, fournir :
    - Nom de l'entreprise
    - SIREN utilisé pour la recherche Pappers
    - Année de création (YYYY) ou "Unknown"
    - Nationalité (FR, INT (Lien FR), US, UK, etc.) ou "Unknown"
    - Typologie SaaS (Pur SaaS, Marketplace, Legacy, Hybrid)
    - Stack technique détectée (si visible)
    - Résumé solution (max 20 mots)
    - Sources utilisées pour vérification

    Indiquer clairement quand une information n'a pas pu être trouvée ou vérifiée.
  agent: corporate_analyst_and_saas_qualifier
  context:
  - extraction_and_macro_filtering
commercial_analysis:
  description: |-
    ACT 4 - Ingénierie Commerciale

    Pour chaque entreprise qualifiée, analyser le potentiel commercial WakaStart :

    ÉTAPE 0 - INVESTIGATION STACK TECHNIQUE (OBLIGATOIRE si non fournie) :
    Si le contexte des tâches précédentes indique "stack non spécifiée" ou ne mentionne pas
    la stack technique, vous DEVEZ investiguer activement :
    1. Scraper la page "Carrières" / "Jobs" / "Recrutement" pour voir les offres d'emploi
       (ex: "Développeur PHP" = stack PHP, "Dev React/Node" = stack moderne)
    2. Scraper la page "À propos" ou "Notre technologie" pour les mentions techniques
    3. Chercher via Serper "[nom entreprise] stack technique" ou "[nom entreprise] recrutement dev"

    INDICES DE STACK VIEILLISSANTE :
    - Offres d'emploi mentionnant PHP, Java EE, .NET Framework, jQuery seul
    - Entreprise créée avant 2015 sans mention de refonte récente
    - Absence totale de mention de technologies modernes (React, Vue, Node.js, Kubernetes)
    - Design web daté, pas de SPA (Single Page Application)

    1. Analyse Financière & Historique :
       - Rechercher les levées de fonds récentes via Serper (besoin d'accélération ?)
       - Identifier l'absence d'évolution depuis 5+ ans (besoin de refonte Legacy ?)
       - Utiliser PappersSearchTool pour les données financières si SIREN disponible
       - Évaluer la maturité de l'entreprise (StartUp, ScaleUp, Legacy)

    2. Matching WakaStart - Croiser les "douleurs" probables avec les solutions :
       - Startup Santé → Besoin HDS/ISO27001 → Score élevé
       - Stack vieillissante détectée → Besoin Migration Pack → Score élevé
       - Scaling difficile → Besoin infrastructure Kubernetes → Score élevé

    3. Calculer le Score de Pertinence (0-100%) - APPLIQUER RIGOUREUSEMENT :
       - 90-100% : Santé (besoin HDS) + stack vieillissante OU entreprise santé créée avant 2018
       - 80-90% : Finance/B2B grands comptes + besoin ISO 27001/NIS2
       - 70-80% : Levée de fonds récente + besoin accélération dev
       - 60-70% : Stack PHP/Python legacy + pas d'évolution 5+ ans
       - 50-60% : SaaS B2B avec besoin multi-tenant/marque blanche
       - <50% : Pas de SaaS clair ou pas d'ancrage France

       RÈGLE SANTÉ : Une entreprise SANTÉ créée avant 2018 a une forte probabilité
       de stack vieillissante (dette technique accumulée)

    4. Rédiger l'Angle d'Attaque DÉTAILLÉ pour le commercial :
       - Identifier le levier PRINCIPAL (dette technique, conformité HDS, scalabilité)
       - Mentionner le levier SECONDAIRE si pertinent
       - Formuler une phrase d'accroche SPÉCIFIQUE au prospect
       Exemple : "Approcher sur l'angle de la conformité HDS (obligatoire secteur santé) + dette technique probable (créée en 2013, stack non modernisée)"

  expected_output: >
    Pour chaque entreprise, fournir :
    - Nom de l'entreprise
    - Stack technique détectée (ou "Non détectée" avec les sources consultées)
    - Score de Pertinence (pourcentage 0-100) avec justification du barème utilisé
    - Justification du score (3-4 raisons clés avec preuves)
    - Angle d'attaque commercial DÉTAILLÉ (levier principal + secondaire)
    - Offres WakaStart recommandées (liste des produits pertinents)

  agent: wakastart_sales_engineer
  context:
  - extraction_and_macro_filtering
  - origin_identification_and_saas_qualification

gamma_webpage_creation:
  description: |-
    Creation de presentations commerciales WakaStart pour chaque prospect via Gamma.

    Pour CHAQUE entreprise ayant ete analysee dans les taches precedentes, creer
    une page web commerciale CLIENT-FACING via l'outil gamma_create_webpage.

    ETAPES OBLIGATOIRES :

    1. EXTRACTION COMPLETE DU CONTEXTE (OBLIGATOIRE - ne rien oublier) :

       Depuis ACT 0+1 (extraction_and_macro_filtering) :
       - Nom de l'entreprise
       - URL du site web
       - Secteur d'activite

       Depuis ACT 2+3 (origin_identification_and_saas_qualification) :
       - Annee de creation (ex: 2013)
       - Nationalite (FR, US, etc.)
       - Solution SaaS (description courte)

       Depuis ACT 4 (commercial_analysis - Agent Cameleon) - CRITIQUE :
       - Stack technique detectee (ex: "PHP avec Laravel/Symfony")
       - Justifications du score (3-4 raisons avec preuves concretes)
       - Levier PRINCIPAL identifie (ex: "Migration Pack pour moderniser stack PHP")
       - Levier SECONDAIRE identifie (ex: "Conformite HDS/ISO 27001")
       - Offres WakaStart recommandees (liste complete)

       IMPORTANT : Si une information est presente dans le contexte, elle DOIT
       etre utilisee dans le prompt Gamma. Ne pas simplifier ou resumer.

    2. REDACTION DU PROMPT DE PERSONNALISATION pour Gamma.
       Ce prompt doit etre DETAILLE et SPECIFIQUE au prospect. Il doit contenir :

       SECTION 1 - Contexte Client (personnalise) :
       - Nom de l'entreprise et secteur d'activite
       - Annee de creation et anciennete (ex: "Plus de 10 ans d'expertise")
       - Stack technique actuelle si detectee (reformuler positivement)
         Ex: "Infrastructure technique en place depuis plusieurs annees, prete pour une evolution"

       SECTION 2 - Defis Identifies (utiliser les justifications du Cameleon) :
       - Reprendre les 3-4 raisons identifiees par l'analyste commercial
       - Les reformuler comme des "opportunites d'amelioration" (ton positif)
       - Mentionner les besoins de conformite si applicable (HDS, ISO 27001, NIS2)

       SECTION 3 - Solutions WakaStart Recommandees :
       - Reprendre les offres recommandees par l'analyste commercial
       - Pour chaque offre, expliquer le benefice CLIENT concret :
         * Developpement rapide : "Accelerez votre time-to-market de 10 a 25x"
         * Migration Pack : "Modernisez votre stack vers Next.js/Nest.js"
         * Securite Secure by Design : "Conformite ISO 27001, HDS, NIS2 native"
         * Multi-tenant : "Architecture prete pour le mode SaaS et marques blanches"
         * Kubernetes OVH : "Scalabilite automatique pour accompagner votre croissance"

       SECTION 4 - Proposition de Valeur Personnalisee :
       - Synthetiser le levier PRINCIPAL en une phrase d'accroche
       - Ajouter le levier SECONDAIRE comme renfort
       - Mentionner des benefices chiffres si possible (couts /5 a /15, delais /10 a /25)

       IMPORTANT sur le TON du prompt :
       - C'est une presentation POUR LE PROSPECT (client final), pas un document interne
       - Ne PAS inclure le score de pertinence (outil interne)
       - Ne PAS utiliser de jargon interne (ACT, Cameleon, angle d'attaque)
       - Reformuler "dette technique" en "opportunite de modernisation"
       - Utiliser un ton professionnel, engageant, oriente benefices client
       - S'adresser au prospect comme un partenaire de confiance

    3. Appeler gamma_create_webpage avec :
       - prompt : le prompt de personnalisation DETAILLE redige ci-dessus
       - company_name : le nom commercial de l'entreprise (ex: "APODIS")
       - company_domain : le domaine du site web sans https:// ni www. (ex: "apodis-sante.com")
         Extraire le domaine depuis l'URL du site web identifie en ACT 0+1.

       L'outil ajoutera automatiquement sur la premiere page :
       - Le logo de l'entreprise prospect (recherche automatique)
       - L'image Opportunity Analysis (WakaStellar)
       - Le logo WakaStellar

    4. Collecter l'URL retournee pour chaque entreprise

  expected_output: >
    Pour chaque entreprise, fournir :
    - Nom de l'entreprise
    - Prompt envoyé a Gamma (3-4 lignes montrant la personnalisation)
    - URL de la page Gamma creee (format https://gamma.app/docs/xxx et URL courte Linkener)
    - Statut de creation (Succes / Echec / Non disponible)

    Si la creation a echoue, indiquer "Non disponible" comme URL.

  agent: gamma_webpage_creator
  context:
    - extraction_and_macro_filtering
    - origin_identification_and_saas_qualification
    - commercial_analysis

decision_makers_identification:
  description: |-
    ACT 5 - Identification des Décisionnaires avec Enrichissement Email Zeliq

    Pour chaque entreprise qualifiée, identifier jusqu'à 3 décideurs clés via Hunter.io,
    puis enrichir leurs emails via Zeliq pour obtenir des adresses plus fiables.

    ÉTAPE 1 - RÉCUPÉRER LE DOMAINE depuis le contexte des tâches précédentes :
    - Extraire le domaine (ex: stripe.com) depuis l'URL du site web identifié en ACT 0+1
    - Ne pas inclure https:// ni www., juste le domaine nu

    ÉTAPE 2 - APPELER OBLIGATOIREMENT l'outil hunter_domain_search avec :
    - domain : Le domaine de l'entreprise (ex: stripe.com)
    - company_name : Le nom de l'entreprise (ex: Stripe)

    L'outil Hunter retourne automatiquement jusqu'à 3 décideurs avec :
    - Nom complet (Prénom NOM)
    - Titre/Fonction exacte
    - Email professionnel (sera enrichi par Zeliq)
    - Numéro de téléphone professionnel
    - URL du profil LinkedIn

    ÉTAPE 3 - ENRICHISSEMENT ZELIQ (OBLIGATOIRE pour chaque décideur avec LinkedIn) :
    Pour CHAQUE décideur ayant une URL LinkedIn valide, appeler zeliq_email_enrich avec :
    - first_name : Prénom du décideur
    - last_name : Nom du décideur
    - company : Le domaine de l'entreprise
    - linkedin_url : L'URL LinkedIn retournée par Hunter

    RÈGLE DE PRIORITÉ EMAIL :
    - Si Zeliq retourne un email → UTILISER l'email Zeliq (plus fiable)
    - Si Zeliq échoue ou timeout → CONSERVER l'email Hunter (fallback)
    - L'email final dans le CSV doit être l'email Zeliq si disponible

    IMPORTANT :
    - Appeler hunter_domain_search UNE SEULE FOIS par entreprise
    - Appeler zeliq_email_enrich pour CHAQUE décideur ayant un LinkedIn valide
    - Ne JAMAIS inventer ou fabriquer un contact
    - Si un décideur n'a pas de LinkedIn, conserver l'email Hunter

  expected_output: >
    Pour chaque entreprise, fournir EXACTEMENT ce format pour chaque décideur (jusqu'à 3) :
    - Décideur 1 : [Prénom NOM], [Titre exact], [Email Zeliq ou Hunter], [Téléphone ou Non trouvé], [URL LinkedIn complète]
    - Décideur 2 : [Prénom NOM], [Titre exact], [Email Zeliq ou Hunter], [Téléphone ou Non trouvé], [URL LinkedIn complète]
    - Décideur 3 : [Prénom NOM], [Titre exact], [Email Zeliq ou Hunter], [Téléphone ou Non trouvé], [URL LinkedIn complète]

    IMPORTANT : Le nom doit TOUJOURS être complet (Prénom NOM).
    L'email doit être celui de Zeliq si disponible, sinon celui de Hunter.
    Si un décideur n'est pas trouvé, indiquer "Non trouvé" pour TOUS ses champs.

  agent: lead_generation_expert
  context:
  - extraction_and_macro_filtering
  - origin_identification_and_saas_qualification
  - commercial_analysis

compile_final_company_analysis_report:
  description: |-
    Compiler toutes les informations collectées dans un CSV de 23 colonnes.
    Sortir UNIQUEMENT les données CSV brutes, sans texte avant ou après.

    RÈGLE PRINCIPALE : Extraire TOUTES les données des tâches précédentes.
    Ne jamais mettre "Unknown" si l'information existe dans le contexte.
    Chercher activement : année de création, score de pertinence, stratégie commerciale,
    noms complets des décideurs, emails, téléphones, LinkedIn, URL page Gamma.

    DÉFINITION PRÉCISE DES COLONNES CRITIQUES (NE PAS CONFONDRE) :
    - "Solution SaaS" (colonne E) : Description COURTE du produit/service en max 20 mots.
      Exemple : "CRM spécialisé santé", "ERP pour PME industrielles"
      Source : tâche origin_identification_and_saas_qualification
    - "Stratégie & Angle" (colonne G) : L'ANGLE D'ATTAQUE COMMERCIAL WakaStart.
      C'est la stratégie de vente contextualisée, PAS la description du produit.
      Chercher dans le contexte les mots-clés : "Angle d'attaque", "Stratégie recommandée",
      "Levier principal", "Phrase d'accroche".
      Exemple : "Approcher sur dette technique + internalisation technologique post-Série A"
      Source : tâche commercial_analysis (agent Ingénieur Commercial)
    - "Page Gamma" (colonne W) : L'URL de la page web Gamma générée.
      Chercher dans le contexte l'URL au format https://gamma.app/docs/xxx
      Source : tâche gamma_webpage_creation
      Si non disponible, indiquer "Non disponible"

    Les 23 colonnes (une ligne par entreprise, champs avec virgules entre guillemets) :
    Société,Site Web,Nationalité,Année Création,Solution SaaS,Pertinence (%),Stratégie & Angle,Décideur 1 - Nom,Décideur 1 - Titre,Décideur 1 - Email,Décideur 1 - Téléphone,Décideur 1 - LinkedIn,Décideur 2 - Nom,Décideur 2 - Titre,Décideur 2 - Email,Décideur 2 - Téléphone,Décideur 2 - LinkedIn,Décideur 3 - Nom,Décideur 3 - Titre,Décideur 3 - Email,Décideur 3 - Téléphone,Décideur 3 - LinkedIn,Page Gamma

    Valeurs par défaut si donnée absente : "Unknown" pour les infos entreprise, "Non trouvé" pour les décideurs, "Non disponible" pour Page Gamma.
  expected_output: |-
    Données CSV brutes avec en-têtes et lignes de données. Format exact (23 colonnes) :
    Société,Site Web,Nationalité,Année Création,Solution SaaS,Pertinence (%),Stratégie & Angle,Décideur 1 - Nom,Décideur 1 - Titre,Décideur 1 - Email,Décideur 1 - Téléphone,Décideur 1 - LinkedIn,Décideur 2 - Nom,Décideur 2 - Titre,Décideur 2 - Email,Décideur 2 - Téléphone,Décideur 2 - LinkedIn,Décideur 3 - Nom,Décideur 3 - Titre,Décideur 3 - Email,Décideur 3 - Téléphone,Décideur 3 - LinkedIn,Page Gamma
  agent: data_compiler_and_reporter
  context:
  - extraction_and_macro_filtering
  - origin_identification_and_saas_qualification
  - commercial_analysis
  - gamma_webpage_creation
  - decision_makers_identification
